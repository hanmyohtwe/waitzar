<html>
<head>
  <title>PEG.js sample test</title>
  <script type="text/javascript" src="lib/compiler.js"> </script>
  <script type="text/javascript" src="lib/metagrammar.js"> </script>
  <script type="text/javascript" src="test_peg.js"> </script>
</head>
<body>
<form action="#" method="post">

<b>Parse Status:</b>
<div id="result" style="color:red;"></div>

<br><b>Sample Input File:</b>
<br><button onclick="parse();" type="button">Parse</button>
<br><textarea name="scrSource" id="scrSource" cols=150 rows=30 style="border:1px solid #333333;">
/*
 * Modified from Dr. Carbon's layout to output Ayar-encoded
 * text using the Zawgyi layout. (Now outputs Unicode)
 * Settings:
    @track_capslocks = "false"
    @eat_all_unused_keys = "true"
    @US_layout_based = "true"
*/

$consU =    U1000 + U1001 + U1002 + U1003 +        U1005 + U1006 + U1007 + \
			U1008 + U1009 + U100A + U100B + U100C + U100D + U100E + U100F + \
			U1010 + U1011 + U1012 + U1013 + U1014 + U1015 + U1016 + U1017 + \
			U1018 + U1019 + U101A + U101B + U101C + U101D + U101E + U101F + \
			U1020 + U1021

/*$consK = 'uc*CpqZ' +\
	'NUn#X!@P' +\
	"wx'" +\
	'"eyzAbr,&vWo[' +\
	'Vt'*/

$twh = U1031
$yayit = U103C
$kinzi = U1004 + U103A + U1039
$ZWS = U200B
$killer = U103A
$bridge = U1039
$bridge_zws = $ZWS + $bridge
$twh_yy = $twh + $yayit + $bridge /* a hacked */ + $ZWS

<VK_SPACE> ==>gt; $ZWS + VK_SPACE
//$ZWS + VK_SPACE + <VK_BACK> ==>gt; null
//Non-Shifted
$row1K = "1234567890"
$row1U = U1041 + U1042 + U1043 + U1044 + U1045 + U1046 + U1047 + U1048 + U1049 + U1040 + /* a hacked */ $ZWS
< VK_OEM_MINUS > ==>gt; '-'
< VK_OEM_PLUS > ==>gt; '='

$row2K = "qwertyuiop[\\"
$row2U = U1006 + U1010 + U1014 + U1019 + U1021 + U1015 + U1000 + U1004 + U101E + U1005 + U101F + U104F

$ZWS[^] + U104F ==>gt; $1 + $ZWS + $2
$row3K = "sdfghkl;'"
$row3U = U103B + U102D + U103A + U102B + U1037 + U102F + U1030 + U1038 + U1012


//$ZWS + $twh + <VK_BACK> ==>gt; null
//$ZWS + $yayit + <VK_BACK> ==>gt; null

//CHANGED: This doesn't make sense! If we type "ju", then after "yayit" is put after
//             "ka", this rule will put a ZWS between the two (when they're clearly part
//             of the same word).
//$twh_yy[^] + $yayit ==>gt; $1 + $ZWS + $yayit
//END CHANGED

//$ZWS + $yayit + <VK_BACK> ==>gt; null
$row4K = "zxcvbnm,./"
$row4U = U1016 + U1011 + U1001 + U101C + U1018 + U100A + U102C + U101A + U002E + U104B
$ZWS[^] + U104B ==>gt; $1 + $ZWS + $2
//$ZWS + U104B + <VK_BACK> ==>gt; null


$row1K[*] ==>gt; $ZWS + $row1U[$1]
$row1U[*] + $ZWS + $row1U[*] ==>gt; $1 + $3
//$ZWS + $row1U[*] + <VK_BACK> ==>gt; null
$row2K[*] ==>gt; $row2U[$1]
$row3K[*] ==>gt; $row3U[$1]
$row4K[*] ==>gt; $row4U[$1]

//Shifted
//Normal First Row
$row1K_S = "!#%^&*()_+"
$row1U_S = U100D + U100B + U0025 + U002F + U101B + U1002 + U0028 + U0029 + U00D7 + U002B
'@' ==>gt; U100F + U1039 + U100D
//U100F + U1039 + U100D + <VK_BACK>==>gt; null
<VK_SHIFT & VK_KEY_4> ==>gt; U1000 + U103B + U1015 + U103A
//U1000 + U103B + U1015 + U103A + <VK_BACK>==>gt; null

$row1K_S[*] ==>gt; $row1U_S[$1]

//Shifted
//Normal Second Row
$row2K_S = "EYUOP{"
$row2U_S = U1014 + U1037 + U1037 + U1025 + U100F + U1027

//CHANGED: Zawgyi uses these for double quotes
//']' ==>gt; U104F
//'}' ==>gt; U100B + U1039 + U100C
//('zg_key') + ';' ==>gt; U003B
//('zg_key') + ':' ==>gt; U003A
']' ==>gt; U201C
'}' ==>gt; U201D
('zg_key') + ';' ==>gt; U2018
('zg_key') + ':' ==>gt; U2019
//END CHANGED


'|' ==>gt; U100B + U1039 + U100C
'Q' ==>gt; U103B + U103E
'W' ==>gt; U103B + U103D + U103E
'R' ==>gt; U103B + U103D
'T' ==>gt; U103D + U103E

//CHANGED: Most likely these are legitimate errors
//'I' ==>gt; U103E + U1030
//('zg_key') + 'o' ==>gt; U101E + U1039 + U101E
//('zg_key') + 'L' ==>gt; U1039 + U1004 + U102D
//('zg_key') + 'D' ==>gt; U1039 + U1004 + U102E
//('zg_key') + 'E' ==>gt; U1039 + U1010 + U103C
//('zg_key') + 'l' ==>gt; U1039 + U1004 + U1036
//('zg_key') + 's' ==>gt; U103A
'I' ==>gt; U103E + U102F
('zg_key') + 'o' ==>gt; U103F
('zg_key') + 'L' ==>gt; $kinzi + U102D
('zg_key') + 'D' ==>gt; $kinzi + U102E
('zg_key') + 'E' ==>gt; U1039 + U1010 + U103D
('zg_key') + 'l' ==>gt; $kinzi + U1036
('zg_key') + 's' ==>gt; U103B
//END CHANGED

//U104E + U1004 + U103A + U1038 + <VK_BACK> ==>gt; null

$row2K_S[*] ==>gt; $row2U_S[$1]

//Shifted
//Normal Third Row
$row3K_S = 'ASDGHJ"'
$row3U_S = U1017 + U103E + U102E + U103D + U1036 + U1032 + U1013

$row3K_S[*] ==>gt; $row3U_S[$1]

//Shifted
//Non-Normal on Third row
< VK_SHIFT & VK_KEY_F > ==>gt; $kinzi
//$kinzi + < VK_BACK > ==>gt; NULL
< VK_SHIFT & VK_KEY_K > ==>gt; U102F
< VK_SHIFT & VK_KEY_L > ==>gt; U1030
< VK_SHIFT & VK_COLON > ==>gt; U102B + U103A
//U102B + U103A + < VK_BACK > ==>gt; NULL

//Shifted
//Normal Fourth Row

//CHANGED: ">" has no entry in the keyboard file
//$row4K_S = "ZXCVBNM<>?"
//$row4U_S = U1007 + U100C + U1003 + U1020 + U103C + U103C + U103C + U101D + U1008 + U104A
$row4K_S = "ZXCV&lt;?"
$row4U_S = U1007 + U100C + U1003 + U1020 + U101D + U104A
//END CHANGED


$ZWS[^] + U104A ==>gt; $1 + $ZWS + $2
//$ZWS + U104a + <VK_BACK> ==>gt; null

$row4K_S[*] ==>gt; $row4U_S[$1]

//< VK_CFLEX > ==>gt; U1039
< VK_CFLEX > ==>gt; ('zg_key')

//Added by Seth: Shift should trigger this too
< VK_SHIFT & VK_CFLEX > ==>gt; ('zg_key')
//End added by Seth

< VK_CAPSLOCK > ==>gt; ('zg_gk')
('zg_gk') + * ==>gt; $1 + ('zg_gk')

//AUTO CORRECTION SECTION

//Number auto-correct
$NumOrLetK = "780"
$NumOrLetU = U1047 + U1048 + U1040
$NumAsLetU = U101B + U1002 + U101D

//prefix autocorrect
$prefix = $twh + $yayit
//$prefix[*] + $NumOrLetK[*] ==>gt; $1 + $NumAsLetU[$2]
//$prefix[*] + $ZWS + $NumOrLetU[*] ==>gt; $1 + $NumAsLetU[$3]
//postfix autocorrect
$postfix = U102E + U102D + U103E + U102E + U103D + U1036 + U1037 + U1032 + U102F + U102B + U1030 + U1038 + U103B + U103A + U1039
//$NumOrLetU[*] + $postfix[*] ==>gt; $1 + $postfix[$2]
$ZWS + $NumOrLetU[*] + $postfix[*] ==>gt; $1 + $NumAsLetU[$2] + $3

//za myin swel
//NOTE: I don't like generating this letter; it messes up some words.
//U1005 + U103B ==>gt; U1008
$bridge_zws[^] + U1008 ==>gt; $1 + $ZWS + $2
$bridge + $ZWS + U1008 ==>gt; $bridge + U1008

$ttt = U1036
$akm = U103B
$ttt + $akm ==>gt; $2 + $1

$ZWS + $NumOrLetU[*] + $NumOrLetU[*] + 'f' ==>gt; $1 + $NumAsLetU[$2] + $NumAsLetU[$3] + U103A
$ZWS + $NumOrLetU[*] + $consU[*] ==>gt; $NumAsLetU[$2] + $3

//Fix "7,8,0" when typed as numbers (but should be letters)
$ZWS + $NumOrLetU[*] + $kinzi ==>gt; $1 + $NumAsLetU[$2] + $3

//REMOVED reordering rules for now... I think we capture them in our own code
//U102F + U102D ==>gt; $2 + $1
//U1037 + U1036 ==>gt; $2 + $1
//U102F + U1036 ==>gt; $2 + $1
//U103E + U103B ==>gt; $2 + $1
//U103D + U103B ==>gt; $2 + $1
//U103E + U103D ==>gt; $2 + $1

U103B + U103B ==>gt; $1
U103E + U103E ==>gt; $1

//U102D + U102D ==>gt; $1
//U102E + U102E ==>gt; $1
//U103A + U103A ==>gt; $1
$kinzi + 'F' ==>gt; $1
U102B + U102B ==>gt; $1
//U103D + U103D ==>gt; $1
U1037 + U1037 ==>gt; $1
//U1036 + U1036 ==>gt; $1
U103C + U103C ==>gt; $1
//U1032 + U1032 ==>gt; $1
//U102F + U102F ==>gt; $1
//U1030 + U1030 ==>gt; $1

//These rules are good, but they don't necessarily capture
// all Burmese. They may be _technically_ correct, but I'm disabling them for now.
$AbvU = U102D + U102E + U103A + U1032
//$AbvU[*] + $AbvU[*] ==>gt; $2
$Abv2U = U1036 + U1032
//$Abv2U[*] + $Abv2U[*] ==>gt; $2
$BlwU = U103D + U102F + U1030
//$BlwU[*] + $BlwU[*] ==>gt; $2

$v1 = U1038 + U104A + U104B
$v2 = U102D + U103A + U1037 + U102E + U1032
$v1[*] + U200B + $v2[*] ==>gt; $3 + U200B + $1

U200B + U1039 ==>gt; U1039

//NOTE: These aren't really needed, since any prefix vowel will insert its own ZWS
//$v3 = U1038 + U1037 + U104B + U104A + U002D + U0028 + U0029
//$v3[*] ==>gt; $1 + U200B

//autocorrect for pat sint
$consU[*] + $AbvU[*] + $bridge + $consU[*] ==>gt; $1 + $3 + $4 + $2 //@DebugBreak
$consU[*] + $Abv2U[*] + $bridge + $consU[*] ==>gt; $1 + $3 + $4 + $2
$consU[*] + $BlwU[*] + $bridge + $consU[*] ==>gt; $1 + $3 + $4 + $2

$twh_yy[^] + $consU[*] ==>gt; $1 + $ZWS + $2

//$ZWS + $consU[*] + <VK_BACK> ==>gt; null
$ZWS + $consU[*] + $killer ==>gt; $2 + $3
U101B + U103B ==>gt; $1 + U103E
//U1036 + U102D ==>gt; $2 + $1

//la kaung
U1044 + U1004 + U103A + U1038 ==>gt; U104E + U1004 + U103A + U1038
U103C + U101E ==>gt; U1029
U1031 + U103C + U101E + U102C + U103A ==>gt; U102A

// '~' + ............
('zg_key') + '4' ==>gt; U104E + U1004 + U103A + U1038
('zg_key') + '5' ==>gt; U1029
('zg_key') + '7' ==>gt; U101B
('zg_key') + '8' ==>gt; U1039 + U1002
('zg_key') + '9' ==>gt; U1026

('zg_key') + 'q' ==>gt; U1039 + U1006
('zg_key') + 'w' ==>gt; U1039 + U1010
('zg_key') + 'e' ==>gt; U1039 + U1014
('zg_key') + 'r' ==>gt; U1039 + U1019
('zg_key') + 't' ==>gt; U1024
('zg_key') + 'u' ==>gt; U1039 + U1000
('zg_key') + 'i' ==>gt; U104D
('zg_key') + 'p' ==>gt; U1039 + U1005
('zg_key') + '[' ==>gt; U005B
('zg_key') + ']' ==>gt; U005D

('zg_key') + 'a' ==>gt; U1008
('zg_key') + 'd' ==>gt; U102D + U1036

('zg_key') + "'" ==>gt; U1039 + U1012

('zg_key') + 'z' ==>gt; U1039 + U1016
('zg_key') + 'x' ==>gt; U1039 + U1011
('zg_key') + 'c' ==>gt; U1039 + U1001
('zg_key') + 'v' ==>gt; U1039 + U101C
('zg_key') + 'b' ==>gt; U1039 + U1018
('zg_key') + '/' ==>gt; U003F

('zg_key') + '$' ==>gt; U1023
('zg_key') + '%' ==>gt; U102A

('zg_key') + 'Q' ==>gt; U1039 + U1006
('zg_key') + 'W' ==>gt; U1039 + U1010
('zg_key') + 'U' ==>gt; U1009
('zg_key') + 'I' ==>gt; U1025
('zg_key') + 'P' ==>gt; U1039 + U100F

('zg_key') + 'A' ==>gt; U1039 + U1017

('zg_key') + '"' ==>gt; U1039 + U1013

('zg_key') + 'Z' ==>gt; U1039 + U1007
('zg_key') + 'C' ==>gt; U1039 + U1003

//CHANGED: Keyboard layout doesn't include these
//('zg_key') + 'V' ==>gt; U1039 + U101C
//('zg_key') + 'B' ==>gt; U1039 + U1018
//('zg_key') + '?' ==>gt; U003F
//('zg_key') + '>' ==>gt; U1039 + U1008
//('zg_key') + '<' ==>gt; U100D + U1039 + U100E
//('zg_key') + 'G' ==>gt; U0047
//('zg_key') + 'H' ==>gt; U0048
//('zg_key') + 'g' ==>gt; U0067
//('zg_key') + 'h' ==>gt; U0068
//('zg_key') + '\\' ==>gt; U005C
//('zg_key') + '#' ==>gt; U100B + U1039 + U100B
//('zg_key') + '^'==>gt; U0036
//('zg_key') + '&' ==>gt; U101B
//('zg_key') + '*' ==>gt; U1039 + U1002
//('zg_key') + '@' ==>gt; U0032
//('zg_key') + '_' ==>gt; U00F7
//('zg_key') + '+' ==>gt; U003D
//('zg_key') + '(' ==>gt; U1026
//('zg_key') + ')' ==>gt; U101D
//('zg_key') + '{' ==>gt; U005B
//('zg_key') + '}' ==>gt; U005D
//('zg_key') + '|' ==>gt; U005C
//('zg_key') + 'K' ==>gt; U103D + U1030
//('zg_key') + 'F' ==>gt; U1039 + U1004 + U102D
//('zg_key') + 'O' ==>gt; U1009 + U102C
//('zg_key') + 'T' ==>gt; U1023
//('zg_key') + 'R' ==>gt; U1039 + U1019
//('zg_key') + '.' ==>gt; U1039 + U1008
//('zg_key') + 'f' ==>gt; U1039 + U1004 + U1036
'>' ==>gt; ''
$consZkeyIgnore = 'ghGHVB?<>\\#^&*@_+(){}|KFOTR.f'
('zg_key') + $consZkeyIgnore[*] ==>gt; ''
//END CHANGED

//CHANGED: Keyboard layout uses these differently
//('zg_key') + 'M' ==>gt; U103B
//('zg_key') + 'N' ==>gt; U103B
//('zg_key') + 'X' ==>gt; U1039 + U100C
//('zg_key') + 'J' ==>gt; U103B
//('zg_key') + '2' ==>gt; U0032
//('zg_key') + '1' ==>gt; U100D + U1039 + U100D
//('zg_key') + '3' ==>gt; U100B + U1039 + U100B
//('zg_key') + '6' ==>gt; U0036
//('zg_key') + '0' ==>gt; U101D
//('zg_key') + '-' ==>gt; U2212
//('zg_key') + '=' ==>gt; U003D
//('zg_key') + 'y' ==>gt; U1039 + U1015
//('zg_key') + 'S' ==>gt; U103D
//('zg_key') + 'Y' ==>gt; U104C
//('zg_key') + ',' ==>gt; U100E
//('zg_key') + 'm' ==>gt; U006D
//('zg_key') + 'n' ==>gt; U1009
//('zg_key') + '!' ==>gt; U100D + U1039 + U100D
//('zg_key') + 'k' ==>gt; U103D + U1030
//('zg_key') + 'j' ==>gt; U103B
('zg_key') + 'N' ==>gt; U1039 + U1008
('zg_key') + 'X' ==>gt; U1039 + U1019
('zg_key') + '2' ==>gt; U1039 + U100C
('zg_key') + '1' ==>gt; U100E
('zg_key') + '3' ==>gt; U1039 + U100B
('zg_key') + '6' ==>gt; ''
('zg_key') + '0' ==>gt; U1039 + U101C
('zg_key') + '-' ==>gt; U100B + U1039 + U100B
('zg_key') + '=' ==>gt; U100D + U1039 + U100D
('zg_key') + 'y' ==>gt; U104C
('zg_key') + 'S' ==>gt; U103E
('zg_key') + 'Y' ==>gt; U1039 + U1015
('zg_key') + ',' ==>gt; ','
('zg_key') + 'n' ==>gt; U100A
('zg_key') + '!' ==>gt; U100D + U1039 + U100E
('zg_key') + 'k' ==>gt; U103E + U1030
//END CHANGED



//NOTE: Put _all_ the $yayit and $twh keys here, since they need special consideration
//Force word breaks, unless another prefix vowel or medial is there
'a' ==>gt; $ZWS + $twh
'j' ==>gt;  $ZWS + $yayit
'B' ==>gt;  $ZWS + $yayit
'N' ==>gt;  $ZWS + $yayit
'M' ==>gt;  $ZWS + $yayit
('zg_key') + 'M' ==>gt; $ZWS + $yayit
('zg_key') + 'J' ==>gt; $ZWS + $yayit
('zg_key') + 'm' ==>gt; $ZWS + $yayit
('zg_key') + 'j' ==>gt; $ZWS + $yayit


U1025 + U1039 + U1025 ==>gt; U1009
U1025 + U102C ==>gt; U1009 + U102C
U101E + U103A + U101E ==>gt; U103F

//Test: Re-order ya-yit, kinzi, and tha-way-htoe. ZWS should prevent re-ordering
//        after typing a second consonant.
//Remove ZWS when re-ordering.
//Make sure to handle the letters that can occur after kinzi, too
$yyORtwh = $yayit + $twh
$afterKinzi = U102D + U102E + U1036
$afterKinzi[*] + $kinzi ==>gt; $2 + $1
$ZWS + $twh + $ZWS + $yayit + $consU[*] + $kinzi + $afterKinzi[*] ==>gt; $6 + $5 + $4 + $2 + $7
$ZWS + $twh + $ZWS + $yayit + $consU[*] + $kinzi ==>gt; $6 + $5 + $4 + $2
$ZWS + $yayit + $ZWS + $twh + $consU[*] + $kinzi + $afterKinzi[*] ==>gt; $6 + $5 + $2 + $4 + $7
$ZWS + $yayit + $ZWS + $twh + $consU[*] + $kinzi ==>gt; $6 + $5 + $2 + $4
$ZWS + $twh + $ZWS + $yayit + $consU[*] ==>gt; $5 + $4 + $2
$ZWS + $yayit + $ZWS + $twh + $consU[*] ==>gt; $5 + $2 + $4
$ZWS + $yyORtwh[*] + $consU[*] + $kinzi + $afterKinzi[*] ==>gt; $4 + $3 + $2 + $5
$ZWS + $yyORtwh[*] + $consU[*] + $kinzi ==>gt; $4 + $3 + $2
$ZWS + $yyORtwh[*] + $consU[*] ==>gt; $3 + $2

//NOTE: Re-ordering occurs in-place, so we need extra rules for "jpF" (see examples below)
$consU[*] + $yayit + $twh + $kinzi + $afterKinzi[*] ==>gt; $4 + $1 + $2 + $3 + $5
$consU[*] + $yyORtwh[*] + $kinzi + $afterKinzi[*] ==>gt; $3 + $1 + $2 + $4
$consU[*] + $kinzi + $afterKinzi[*] ==>gt; $2 + $1 + $3
$consU[*] + $yayit + $twh + $kinzi ==>gt; $4 + $1 + $2 + $3
$consU[*] + $yyORtwh[*] + $kinzi ==>gt; $3 + $1 + $2
$consU[*] + $kinzi ==>gt; $2 + $1

//More re-ordering with stacked consonant and optional medial-ya
//$consU is a superset of stackable letters, so just use that.
$consU[*] + $yayit + $twh + U1039 + $consU[*] + U103B ==>gt; $1 + $4 + $5 + $6 + $2 + $3
$consU[*] + $yayit + $twh + U103B ==>gt; $1 + $4 + $2 + $3
$consU[*] + $yayit + $twh + U1039 + $consU[*] ==>gt; $1 + $4 + $5 + $2 + $3
$consU[*] + $yyORtwh[*] + U1039 + $consU[*] + U103B ==>gt; $1 + $3 + $4 + $5 + $2
$consU[*] + $yyORtwh[*] + U103B ==>gt; $1 + $3 + $2
$consU[*] + $yyORtwh[*] + U1039 + $consU[*] ==>gt; $1 + $3 + $4 + $2
$consU[*]+ U103B + U1039 + $consU[*] ==>gt; $1 + $3 + $4 + $2

//Stacked plus kinzi
$consU[*] + $yayit + $twh + U1039 + $consU[*] + $kinzi + $afterKinzi[*] ==>gt; $6 + $1 + $2 + $3 + $4 + $5 + $7
$consU[*] + $yyORtwh[*] + U1039 + $consU[*] + $kinzi + $afterKinzi[*] ==>gt; $5 + $1 + $2 + $3 + $4 + $6
$consU[*] + U1039 + $consU[*] + $kinzi + $afterKinzi[*] ==>gt; $4 + $1 + $2 + $3 + $5
$consU[*] + $yayit + $twh + U1039 + $consU[*] + $kinzi ==>gt; $6 + $1 + $2 + $3 + $4 + $5
$consU[*] + $yyORtwh[*] + U1039 + $consU[*] + $kinzi ==>gt; $5 + $1 + $2 + $3 + $4
$consU[*] + U1039 + $consU[*] + $kinzi ==>gt; $4 + $1 + $2 + $3

//Kinzi plus U103B
$consU[*] + $yayit + $twh + U103B + $kinzi + $afterKinzi[*] ==>gt; $5 + $1 + $2 + $3 + $4 + $6
$consU[*] + $yyORtwh[*] + U103B + $kinzi + $afterKinzi[*] ==>gt; $4 + $1 + $2 + $3 + $5
$consU[*]+ U103B + $kinzi + $afterKinzi[*] ==>gt; $3 + $1 + $2 + $4
$consU[*] + $yayit + $twh + U103B + $kinzi ==>gt; $5 + $1 + $2 + $3 + $4
$consU[*] + $yyORtwh[*] + U103B + $kinzi ==>gt; $4 + $1 + $2 + $3
$consU[*]+ U103B + $kinzi ==>gt; $3 + $1 + $2

//Re-order with circle-below and aspirator character; put before twh
$twh + U103D + U103E ==>gt; $2 + $3 + $1
$twh + U103E + U103D ==>gt; $3 + $2 + $1
U103D + $twh + U103E ==>gt; $1 + $3 + $2
U103E + $twh + U103D ==>gt; $3 + $1 + $2
$twh + U103E ==>gt; $2 + $1
$twh + U103D ==>gt; $2 + $1
U103E + U103D ==>gt; $2 + $1

//Handle U103B after this mess
$specLower = U103D + U103E
$specLower[*] + $specLower[*] + $twh + U103B ==>gt; $4 + $1 + $2 + $3
$specLower[*] + $twh + U103B ==>gt; $3 + $1 + $2

//Fix ordering of circle-above and leg-below
$upperVowel = U102D + U102E + U1032
$lowerVowel = U102F + U1030

//Fix ordering of closing medials + asat
$dotAbove = U1036
$dotBelow = U1037
$asat = U103A

//Fix a few more cases of U103B
//NOTE: Ensure U103D + U103E is enforced whenever it's not set to last
$upperVowel[*] + $dotAbove[*] + $specLower[*] + U103B ==>gt; $4 + $3 + $1 + $2
$specLower[*] + $upperVowel[*] + $dotAbove[*] + U103B ==>gt; $4 + $1 + $2 + $3
$upperVowel[*] + U103E + U103D + U103B ==>gt; $4 + $3 + $2 + $1
$upperVowel[*] + $specLower[*] + $specLower[*] + U103B ==>gt; $4 + $2 + $3 + $1
U103E + U103D + $upperVowel[*] + U103B ==>gt; $4 + $2 + $1 + $3
$specLower[*] + $specLower[*] + $upperVowel[*] + U103B ==>gt; $4 + $1 + $2 + $3
$upperVowel[*] + U103B + U103E + U103D ==>gt; $2 + $4 + $3 + $1
$upperVowel[*] + U103B + $specLower[*] + $specLower[*] ==>gt; $2 + $3 + $4 + $1
U103E + $upperVowel[*] + U103D + U103B ==>gt; $4 + $3 + $1 + $2
$specLower[*] + $upperVowel[*] + $specLower[*] + U103B ==>gt; $4 + $1 + $3 + $2
U103E + $upperVowel[*] + U103B + U103D ==>gt; $3 + $4 + $1 + $2
$specLower[*] + $upperVowel[*] + U103B + $specLower[*] ==>gt; $3 + $1 + $4 + $2
$upperVowel[*] + U103E + U103B + U103D ==>gt; $3 + $4 + $2 + $1
$upperVowel[*] + $specLower[*] + U103B + $specLower[*] ==>gt; $3 + $2 + $4 + $1
$upperVowel[*] + $dotAbove[*] + U103B ==>gt; $3 + $1 + $2
$upperVowel[*] + $specLower[*] + U103B ==>gt; $3 + $2 + $1
$specLower[*] + $upperVowel[*] + U103B ==>gt; $3 + $1 + $2
$dotAbove[*] + $specLower[*] + U103B ==>gt; $3 + $2 + $1
$specLower[*] + $dotAbove[*] + U103B ==>gt; $3 + $1 + $2
U103E + U103D + U103B ==>gt; $3 + $2 + $1
$specLower[*] + $specLower[*] + U103B ==>gt; $3 + $1 + $2
$specLower[*] + U103B ==>gt; $2 + $1
$upperVowel[*] + U103B ==>gt; $2 + $1
$dotAbove[*] + U103B ==>gt; $2 + $1

//Fix bad normalization all in a row
//Step 1: Get upper vowel in place
$threeVowels = $lowerVowel + $dotAbove + $dotBelow
$threeVowels[*] + $upperVowel[*] + $threeVowels[*] + $threeVowels[*] ==>gt; $2 + $1 + $3 + $4
$threeVowels[*] + $threeVowels[*] + $upperVowel[*] + $threeVowels[*] ==>gt; $3 + $1 + $2 + $4
$threeVowels[*] + $threeVowels[*] + $threeVowels[*] + $upperVowel[*] ==>gt; $4 + $1 + $2 + $3
$threeVowels[*] + $upperVowel[*] + $threeVowels[*] ==>gt; $2 + $1 + $3
$threeVowels[*] + $threeVowels[*] + $upperVowel[*] ==>gt; $3 + $1 + $2
$threeVowels[*] + $upperVowel[*] ==>gt; $2 + $1

//Step 2: Get lower vowel into place
$twoVowels = $dotAbove + $dotBelow
$twoVowels[*] + $lowerVowel[*] + $twoVowels[*] ==>gt; $2 + $1 + $3
$twoVowels[*] + $twoVowels[*] + $lowerVowel[*] ==>gt; $3 + $1 + $2
$twoVowels[*] + $lowerVowel[*] ==>gt; $2 + $1

//Step 3: Get dot above into place
$oneVowel = $dotBelow
$oneVowel + $dotAbove  ==>gt; $2 + $1

//Fix asat and dot below
$asat[*] + $dotBelow[*] ==>gt; $2 + $1

//Now, there's one more possibility: an $upperVowel could be competing with $specLower
//(AND upper vowels might have a dot.)
$twh + $dotAbove[*] + $upperVowel[*] + $specLower[*] + $specLower[*] ==>gt; $4 + $5 + $1 + $3 + $2
$twh + $upperVowel[*] + $dotAbove[*] + $specLower[*] + $specLower[*] ==>gt; $4 + $5 + $1 + $2 + $3
$twh + $upperVowel[*] + $specLower[*] + $dotAbove[*] + $specLower[*] ==>gt; $3 + $5 + $1 + $2 + $4
$twh + $upperVowel[*] + $specLower[*] + $specLower[*] + $dotAbove[*] ==>gt; $3 + $4 + $1 + $2 + $5
$twh + $dotAbove[*] + $upperVowel[*] + $specLower[*] ==>gt; $4 + $1 + $3 + $2
$twh + $dotAbove[*] + $specLower[*] + $upperVowel[*] ==>gt; $3 + $1 + $4 + $2
$twh + $upperVowel[*] + $dotAbove[*] + $specLower[*] ==>gt; $4 + $1 + $2 + $3
$twh + $upperVowel[*] + $specLower[*] + $dotAbove[*] ==>gt; $3 + $1 + $2 + $4
$twh + $upperVowel[*] + $specLower[*] + $specLower[*] ==>gt; $3 + $4 + $1 + $2
$twh + $upperVowel[*] + $specLower[*] ==>gt; $3 + $1 + $2
$dotAbove[*] + $upperVowel[*] + $specLower[*] + $specLower[*] ==>gt; $3 + $4 + $2 + $1
$upperVowel[*] + $dotAbove[*] + $specLower[*] + $specLower[*] ==>gt; $3 + $4 + $1 + $2
$upperVowel[*] + $specLower[*] + $dotAbove[*] + $specLower[*] ==>gt; $2 + $4 + $1 + $3
$upperVowel[*] + $specLower[*] + $specLower[*] + $dotAbove[*] ==>gt; $2 + $3 + $1 + $4
$dotAbove[*] + $upperVowel[*] + $specLower[*] ==>gt; $3 + $2 + $1
$dotAbove[*] + $specLower[*] + $upperVowel[*] ==>gt; $2 + $3 + $1
$upperVowel[*] + $dotAbove[*] + $specLower[*] ==>gt; $3 + $1 + $2
$upperVowel[*] + $specLower[*] + $dotAbove[*] ==>gt; $2 + $1 + $3
$upperVowel[*] + $specLower[*] + $lowerVowel[*] ==>gt; $2 + $1 + $3
$upperVowel[*] + $specLower[*] + $specLower[*] ==>gt; $2 + $3 + $1
U103E + $upperVowel[*] + U103D ==>gt; $3 + $1 + $2
$upperVowel[*] + $specLower[*] ==>gt; $2 + $1



//Minor cleanup; hope this won't loop much
// (we expand the search a few times to avoid pointless looping)
$ZWS + $ZWS + $ZWS + $ZWS + $ZWS ==>gt; $1
$ZWS + $ZWS + $ZWS + $ZWS ==>gt; $1
$ZWS + $ZWS + $ZWS ==>gt; $1
$ZWS + $ZWS ==>gt; $1
</textarea>
</form>




</body>
</html>
